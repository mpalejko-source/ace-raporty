<!doctype html>
<html lang="pl">
<head>
  <script>
    if (sessionStorage.getItem("ace_access") !== "1") {
      window.location.href = "../../login.html";
    }
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ACE ‚Äì Analizy Statystyczno-Techniczne</title>

  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root{
      --bg:#0b1220;
      --border:rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.72);
      --muted2:rgba(234,240,255,.55);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(125,211,252,.14), transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, rgba(167,139,250,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:26px 18px 44px;
    }
    header{
      display:flex; justify-content:space-between; gap:14px; flex-wrap:wrap;
      margin-bottom:14px;
      align-items:flex-start;
    }
    .brand{display:flex; gap:14px; align-items:center;}
    .logo{
      height:54px;
      width:auto;
      display:block;
      filter: drop-shadow(0 10px 24px rgba(0,0,0,.45));
    }
    h1{margin:0; font-size:22px}
    .sub{margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35}

    .topRow{
      margin:10px 0 18px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .pill{
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      padding:8px 12px;
      border-radius:999px;
      color:var(--muted2);
      font-size:12px;
      box-shadow: var(--shadow);
      white-space:nowrap;
      display:inline-flex; gap:8px; align-items:center;
    }
    .btn{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.92);
      font-size:13px;
      text-decoration:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .btn:hover{ background: rgba(255,255,255,.10); }

    .sectionTitle{
      margin:18px 0 10px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .sectionTitle .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.90);
      box-shadow: var(--shadow);
    }
    .sectionTitle h2{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .sectionTitle p{
      margin:0;
      color:var(--muted2);
      font-size:12px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap:12px;
    }
    a.card{
      display:block;
      text-decoration:none;
      color:inherit;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      padding:14px;
      position:relative;
      overflow:hidden;
      transition: transform .08s ease, border-color .08s ease;
      min-height:110px;
    }
    a.card:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); }
    a.card:before{
      content:"";
      position:absolute; inset:-1px;
      background: radial-gradient(520px 160px at 10% 0%, rgba(125,211,252,.14), transparent 60%),
                  radial-gradient(520px 200px at 90% 0%, rgba(167,139,250,.12), transparent 60%);
      pointer-events:none;
    }
    a.card > *{ position:relative; }

    .cardTop{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.90);
      white-space:nowrap;
    }
    .badge.accent{
      border-color: rgba(125,211,252,.40);
      background: rgba(125,211,252,.12);
    }
    .title{
      margin:0;
      font-size:15px;
      font-weight:950;
      line-height:1.2;
    }
    .desc{
      margin:8px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .meta{
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid rgba(255,255,255,.08);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size:12px;
      color:var(--muted2);
    }
    .meta strong{ color: rgba(234,240,255,.92); font-weight:900; }

    .error{
      border:1px solid rgba(255,120,120,.25);
      background: rgba(255,120,120,.08);
      padding:12px 14px;
      border-radius:14px;
      color:rgba(255,220,220,.92);
      margin-top:14px;
      font-size:13px;
      box-shadow: var(--shadow);
      white-space:pre-wrap;
    }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="brand">
      <img src="../../logo.png" class="logo" alt="ACE Group">
      <div>
        <h1>ACE ‚Äì Analizy Statystyczno-Techniczne</h1>
        <p class="sub">Waluty, zbo≈ºa, ≈õruty i energia ‚Äî raporty w uk≈Çadzie sekcji z kafelkami.</p>
      </div>
    </div>

    <div class="pill" id="asof">üìç Olsztyn ‚Ä¢ ‚è± ‚Äî</div>
  </header>

  <div class="topRow">
    <a class="btn" href="../../index.html">‚Üê Panel g≈Ç√≥wny</a>
    <div class="pill">üìÅ Folder: <strong>analizy-stat-tech</strong></div>
  </div>

  <div id="content"></div>
  <div id="err" class="error" style="display:none"></div>
</div>

<script>
  // ======== USTAWIENIA SEKCJI (Twoje grupy) ========
  // id muszƒÖ istnieƒá w manifest.json
  const GROUPS = [
    { key:"waluty", title:"Waluty", icon:"üí±", hint:"USD/PLN, EUR/PLN, EUR/USD", ids:["usdpln","eurpln","eurusd"] },
    { key:"zboza",  title:"Zbo≈ºa",  icon:"üåæ", hint:"Pszenica, kukurydza, rzepak", ids:["pszenica","kukurydza","rzepak"] },
    { key:"sruty",  title:"≈öruty",  icon:"üß©", hint:"Sojowa i rzepakowa", ids:["sruta-sojowa","sruta-rzepakowa"] },
    { key:"energia",title:"Energia",icon:"‚ö°", hint:"PrƒÖd i gaz", ids:["prad","gaz"] }
  ];

  function showErr(msg){
    const box = document.getElementById("err");
    box.style.display = "block";
    box.textContent = msg;
  }

  function fmtDatePL(iso){
    if(!iso || typeof iso !== "string") return "‚Äî";
    const p = iso.split("-");
    if(p.length !== 3) return iso;
    return `${p[2]}.${p[1]}.${p[0]}`;
  }

  function parseISO(iso){
    if(!iso) return -Infinity;
    const t = Date.parse(iso + "T00:00:00Z");
    return isNaN(t) ? -Infinity : t;
  }

  function daysUntil(iso){
    if(!iso) return null;
    const t = Date.parse(iso + "T00:00:00Z");
    if(isNaN(t)) return null;
    const now = new Date();
    const today = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate());
    return Math.round((t - today)/(24*60*60*1000));
  }

  async function loadManifest(){
    // UWAGA: jeste≈õmy 2 poziomy ni≈ºej -> ../../manifest.json
    const url = "../../manifest.json?ts=" + Date.now();
    const res = await fetch(url, { cache:"no-store" });
    if(!res.ok) throw new Error("Nie mogƒô wczytaƒá ../../manifest.json (" + res.status + ")");
    return await res.json();
  }

  function esc(s){
    return (s||"").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  function render(groups, byId){
    const host = document.getElementById("content");

    host.innerHTML = groups.map(g=>{
      const cards = g.ids
        .map(id => ({ id, r: byId[id] }))
        .filter(x => !!x.r);

      const missing = g.ids.filter(id => !byId[id]);

      return `
        <div class="sectionTitle">
          <span class="tag">${esc(g.icon)} <strong>${esc(g.title)}</strong></span>
          <div>
            <h2>${esc(g.title)}</h2>
            <p>${esc(g.hint)}</p>
          </div>
        </div>

        ${missing.length ? `
          <div class="error" style="margin:0 0 12px 0">
            Brak w manifest.json ID: ${missing.map(esc).join(", ")}
          </div>
        ` : ""}

        <section class="grid">
          ${cards.map(x=>{
            const r = x.r;
            const next = (r.next_issue || r.nextIssue || r.next || "").toString().trim();
            let nextTxt = "‚Äî";
            if(next){
              const d = daysUntil(next);
              nextTxt = fmtDatePL(next) + (d!==null ? ` (za ${d} dni)` : "");
            }
            const freq = (r.frequency || r.freq || "").toString().trim() || "raport";
            const path = (r.path || ("../" + x.id + "/")).replace(/^\/+/, "");

            return `
              <a class="card" href="../../${path}">
                <div class="cardTop">
                  <span class="badge accent">${esc(freq)}</span>
                  <span class="badge">Aktualizacja: ${esc(fmtDatePL(r.updated || ""))}</span>
                </div>
                <p class="title">${esc(r.name || x.id)}</p>
                <p class="desc">${esc(r.description || "")}</p>
                <div class="meta">
                  <span><strong>Kolejne wydanie:</strong> ${esc(nextTxt)}</span>
                </div>
              </a>
            `;
          }).join("")}
        </section>
      `;
    }).join("");
  }

  (async ()=>{
    try{
      const now = new Date();
      const date = now.toLocaleDateString("pl-PL");
      const time = now.toLocaleTimeString("pl-PL", { hour:"2-digit", minute:"2-digit" });
      document.getElementById("asof").textContent = `üìç Olsztyn ‚Ä¢ ‚è± ${date} ${time}`;

      const manifest = await loadManifest();
      const byId = {};
      for(const [id, r] of Object.entries(manifest)){
        byId[id] = r || {};
      }

      render(GROUPS, byId);
    } catch(e){
      showErr("B≈ÇƒÖd strony folderu: " + (e && e.message ? e.message : e));
    }
  })();
</script>
</body>
</html>
